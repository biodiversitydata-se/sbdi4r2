[{"path":"/articles/sbdi4r.html","id":"using-sbdi4r2","dir":"Articles","previous_headings":"","what":"Using sbdi4r2","title":"Introduction to sbdi4r2","text":"Let’s assume already installed package shown main site. Load sbdi4r2 package: , check additional packages ’ll use examples, install necessary.","code":"library(sbdi4r2) library(galah) sbdi_config(email = \"aleruete@gmail.com\") #> ✔ verbose #> ✔ run_checks #> ✖ send_email #> ℹ directory: C:\\Users\\ALEJAN~1.AZU\\AppData\\Local\\Temp\\RtmpQnGcxp #> • username [Not Provided] #> • email    aleruete@gmail.com #> • password [Not Provided] #> • api_key  [Not Provided] #> • download_reason_id   4 #> • Swedish Biodiversity Data Infrastructure (SBDI), Sweden to_install <- c( \"dplyr\", \"ggplot2\",  \"lubridate\", \"leaflet\",\"maps\", \"mapdata\",                  \"sf\",  \"tidyr\", \"vegan\")  to_install <- to_install[!sapply(to_install, requireNamespace, quietly = TRUE)] if (length(to_install) > 0)     install.packages(to_install, repos = \"http://cran.us.r-project.org\")"},{"path":[]},{"path":"/articles/sbdi4r.html","id":"example-1-name-searching-and-taxonomic-trees","dir":"Articles","previous_headings":"NOT WORKING","what":"Example 1: Name searching and taxonomic trees","title":"Introduction to sbdi4r2","text":"want look taxonomy titmice, don’t know correct scientific name , let’s search : whole family Filter restrict species hybrids","code":"sx <- sbdi_call() |>    sbdi_identify(\"parus\") |>    atlas_species() sx sx <- sbdi_call() |>      sbdi_identify(\"paridae\") |>      atlas_species() sx <- sx |>    filter(Genus != \"\") ## restrict to species and not hybrids"},{"path":"/articles/sbdi4r.html","id":"example-2-get-some-data-filter-the-search-get-quality-assertions-plotting-data-on-a-map-and-save-data","dir":"Articles","previous_headings":"NOT WORKING","what":"Example 2: Get some data, filter the search, get quality assertions, plotting data on a map and save data","title":"Introduction to sbdi4r2","text":"Download occurrence data “Sommarlånke” view top data table: can also search set species simultaneously (scientific names far)…","code":"focal_spp <- search_taxa(\"Callitriche cophocarpa\") ## or equally valid focal_spp <- search_taxa(\"sommarlånke\") focal_spp$taxon_concept_id #> [1] \"8236752\"  x <- sbdi_call() |>    sbdi_identify(\"Callitriche cophocarpa\") |>   atlas_occurrences() #> Request for 614 occurrences placed in queue #> Current queue length: 1 #> -- #> Downloading  table(x$dataResourceName) #>  #>                                                                      Herbarium GB, University of Gothenburg  #>                                                                                                           2  #>                                               Lund University Biological Museum - Botanical collection (LD)  #>                                                                                                         384  #>                                                                             National Wetland Inventory (NV)  #>                                                                                                          15  #>                                                                                  Oskarshamn herbarium (OHN)  #>                                                                                                         211  #> SHARK - Regional marine environmental monitoring and monitoring projects of Epibenthos in Sweden since 1994  #>                                                                                                           2 taxa <- c(\"Callitriche\", \"Anarrhinum\") x <- sbdi_call() |>    sbdi_identify(taxa) |>   atlas_occurrences() #> ---  table(x$dataResourceName) #>  #>                                                            Artportalen (Swedish Species Observation System)  #>                                                                                                       21330  #>                                                                                                Botany (UPS)  #>                                                                                                         487  #>                                                                      Herbarium GB, University of Gothenburg  #>                                                                                                          17  #>                                               Lund University Biological Museum - Botanical collection (LD)  #>                                                                                                        2156  #>                                                                             National Wetland Inventory (NV)  #>                                                                                                          89  #>                                                                                  Oskarshamn herbarium (OHN)  #>                                                                                                         776  #>                                                                      Phanerogamic Botanical Collections (S)  #>                                                                                                        2628  #>                         SHARK - National marine environmental monitoring of Epibenthos in Sweden since 1992  #>                                                                                                          56  #> SHARK - Regional marine environmental monitoring and monitoring projects of Epibenthos in Sweden since 1994  #>                                                                                                        2309  #>                                                                                       The Bergius Herbarium  #>                                                                                                           1"},{"path":"/articles/sbdi4r.html","id":"search-filters","dir":"Articles","previous_headings":"NOT WORKING > Example 2: Get some data, filter the search, get quality assertions, plotting data on a map and save data","what":"Search filters","title":"Introduction to sbdi4r2","text":"different data sources. Let’s assume need see data one source, e.g. Lund University Biological Museum - Botanical collection (LD):","code":"taxa <- \"Callitriche cophocarpa\" xf <- sbdi_call() |>    sbdi_identify(taxa) |>   filter(dataResourceName == \"Lund University Biological Museum - Botanical collection (LD)\") |>   atlas_occurrences() #> -- table(xf$dataResourceName) #>  #> Lund University Biological Museum - Botanical collection (LD)  #>                                                           384"},{"path":"/articles/sbdi4r.html","id":"change-to-show_allfields","dir":"Articles","previous_headings":"NOT WORKING","what":"change to show_all(fields)","title":"Introduction to sbdi4r2","text":"way can use spatial layers available spatially search indexed observations. Note fundamentally different filtering county=Uppsala search text Uppsala field county, rather spatially matching observations.","code":"show_all(fields)  show_all(fields) |>    filter(grepl(\"cl\", id)) |>     as.data.frame() show_all(fields) |>    filter(description == \"LA-regioner\") |>    as.data.frame()  show_all(fields) |>    filter(description == \"Län\") |>    as.data.frame()  xf <- sbdi_call() |>    sbdi_identify(taxa) |>   filter(\"cl10097\" == \"Uppsala\") |>   atlas_occurrences()"},{"path":"/articles/sbdi4r.html","id":"other-filters-on-queries","dir":"Articles","previous_headings":"NOT WORKING > change to show_all(fields)","what":"Other filters on queries","title":"Introduction to sbdi4r2","text":"search filtered indexed field (.k.. column variable). can find variables indexed command `c filter strings require SOLR syntax, see SOLR example, let’s filter observations coordinate uncertainty smaller equal 100 m. One search observations specific years: way, one search observations two years:  Likewise, search conditions can accumulated treated conditions:  , occurrences filtered basis record (observation recorded):","code":"xf <- sbdi_call() |>    sbdi_identify(taxa) |>   filter(coordinateUncertaintyInMeters <= 100) |>   atlas_occurrences() #> - x2yr <- sbdi_call() |>    sbdi_identify(taxa) |>   filter(year == 2010 | year == 2020) |>   atlas_occurrences() nrow(x2yr) #> [1] 2 xf <- sbdi_call() |>    sbdi_identify(taxa) |>   filter(year >= 2010, year <= 2020) |>   atlas_occurrences() #> -  library(lubridate) hist(year(xf$eventDate), xlab = \"Year\", main = \"\") xf <- sbdi_call() |>    sbdi_identify(taxa) |>   filter(year >= 2010, year <= 2020,          month >= 6, month <= 8) |>   atlas_occurrences() #> -  hist(month(xf$eventDate), xlab = \"Month\", main = \"\") xbor <- sbdi_call() |>    sbdi_identify(taxa) |>   filter(basisOfRecord == \"PreservedSpecimen\") |>   select(basisOfRecord) |>    atlas_occurrences() #> --                     unique(xbor$basisOfRecord) #> [1] \"PRESERVED_SPECIMEN\""},{"path":"/articles/sbdi4r.html","id":"quality-assertions","dir":"Articles","previous_headings":"NOT WORKING > change to show_all(fields)","what":"Quality assertions","title":"Introduction to sbdi4r2","text":"Data quality assertions suite fields result set tests performed data. continue using data Blunt-fruited Water-starwort get summary data quality assertions, can see list record issues using show_all(assertions) see considered fatal quality issues, category = “Error”.","code":"show_all(assertions) #> # A tibble: 114 × 4 #>    id                                 description                 category type  #>    <chr>                              <chr>                       <chr>    <chr> #>  1 AMBIGUOUS_COLLECTION               Ambiguous collection        Warning  asse… #>  2 AMBIGUOUS_INSTITUTION              Ambiguous institution       Warning  asse… #>  3 BASIS_OF_RECORD_INVALID            Basis of record badly form… Warning  asse… #>  4 biosecurityIssue                   Biosecurity issue           Error    asse… #>  5 COLLECTION_MATCH_FUZZY             Collection match fuzzy      Warning  asse… #>  6 COLLECTION_MATCH_NONE              Collection not matched      Warning  asse… #>  7 CONTINENT_COUNTRY_MISMATCH         Continent country mismatch  Warning  asse… #>  8 CONTINENT_DERIVED_FROM_COORDINATES Continent derived from coo… Warning  asse… #>  9 CONTINENT_INVALID                  Continent invalid           Warning  asse… #> 10 COORDINATE_INVALID                 Coordinate invalid          Warning  asse… #> # ℹ 104 more rows assertFatal <- show_all(assertions) |>    filter(category == \"Error\") search_all(assertions, \"longitude\") #> # A tibble: 2 × 4 #>   id                             description                      category type  #>   <chr>                          <chr>                            <chr>    <chr> #> 1 PRESUMED_NEGATED_LONGITUDE     Longitude is negated             Warning  asse… #> 2 COORDINATE_REPROJECTION_FAILED Decimal latitude/longitude conv… Warning  asse…  xassert <- sbdi_call() |>    sbdi_identify(taxa) |>   select(assertFatal$id) |>    atlas_occurrences() #> Request for 614 occurrences placed in queue #> Current queue length: 1 #> -- #> Downloading  colSums(xassert[,assertFatal$id]) #>                biosecurityIssue                 detectedOutlier  #>                               0                               0  #>                 habitatMismatch         identificationIncorrect  #>                               0                               0  #>            INTERPRETATION_ERROR      SENSITIVITY_REPORT_INVALID  #>                               0                               0  #> SENSITIVITY_REPORT_NOT_LOADABLE                  taxonomicIssue  #>                               0                               0  #>                   temporalIssue    UNRECOGNISED_COLLECTION_CODE  #>                               0                               0  #>   UNRECOGNISED_INSTITUTION_CODE              userAssertionOther  #>                               0                               0  assertWarning <- show_all(assertions) |>    filter(category == \"Warning\")  xassert <- sbdi_call() |>    sbdi_identify(taxa) |>   select(assertWarning$id) |>    atlas_occurrences() #> Request for 614 occurrences placed in queue #> Current queue length: 1 #> -- #> Downloading  colSums(xassert[,assertWarning$id]) #>                              AMBIGUOUS_COLLECTION  #>                                                 0  #>                             AMBIGUOUS_INSTITUTION  #>                                                 0  #>                           BASIS_OF_RECORD_INVALID  #>                                                 0  #>                            COLLECTION_MATCH_FUZZY  #>                                                 0  #>                             COLLECTION_MATCH_NONE  #>                                                 0  #>                        CONTINENT_COUNTRY_MISMATCH  #>                                                 0  #>                CONTINENT_DERIVED_FROM_COORDINATES  #>                                                 0  #>                                 CONTINENT_INVALID  #>                                                 0  #>                                COORDINATE_INVALID  #>                                                 0  #>                           COORDINATE_OUT_OF_RANGE  #>                                                 0  #>                      COORDINATE_PRECISION_INVALID  #>                                               122  #>                    COORDINATE_REPROJECTION_FAILED  #>                                                 0  #>                COORDINATE_REPROJECTION_SUSPICIOUS  #>                                                 0  #>             COORDINATE_UNCERTAINTY_METERS_INVALID  #>                                               404  #>                     COORDINATES_CENTRE_OF_COUNTRY  #>                                                 0  #>               COORDINATES_CENTRE_OF_STATEPROVINCE  #>                                                 0  #>                       COUNTRY_COORDINATE_MISMATCH  #>                                                 1  #>                  COUNTRY_DERIVED_FROM_COORDINATES  #>                                                 2  #>                                   COUNTRY_INVALID  #>                                                 0  #>                                  COUNTRY_MISMATCH  #>                                                 0  #>                             DEPTH_MIN_MAX_SWAPPED  #>                                                 0  #>                                 DEPTH_NON_NUMERIC  #>                                                 0  #>                                  DEPTH_NOT_METRIC  #>                                                 0  #>                                    DEPTH_UNLIKELY  #>                                                 0  #>                         ELEVATION_MIN_MAX_SWAPPED  #>                                                 0  #>                             ELEVATION_NON_NUMERIC  #>                                                 0  #>                              ELEVATION_NOT_METRIC  #>                                                 0  #>                                ELEVATION_UNLIKELY  #>                                                 0  #>                                  FIRST_OF_CENTURY  #>                                                 0  #>                                    FIRST_OF_MONTH  #>                                                19  #>                                     FIRST_OF_YEAR  #>                                                 0  #>                             FOOTPRINT_SRS_INVALID  #>                                                 0  #>                             FOOTPRINT_WKT_INVALID  #>                                                 0  #>                            FOOTPRINT_WKT_MISMATCH  #>                                                 0  #>                            GEODETIC_DATUM_INVALID  #>                                                 0  #>                      GEOREFERENCE_POST_OCCURRENCE  #>                                                 0  #>                        GEOREFERENCED_DATE_INVALID  #>                                                 0  #>                       GEOREFERENCED_DATE_UNLIKELY  #>                                                 0  #>                                   geospatialIssue  #>                                                 0  #>                                 ID_PRE_OCCURRENCE  #>                                                 0  #>                           IDENTIFIED_DATE_INVALID  #>                                                 0  #>                          IDENTIFIED_DATE_UNLIKELY  #>                                                 0  #> INDIVIDUAL_COUNT_CONFLICTS_WITH_OCCURRENCE_STATUS  #>                                                 0  #>                          INDIVIDUAL_COUNT_INVALID  #>                                                 0  #>                   INSTITUTION_COLLECTION_MISMATCH  #>                                                 0  #>                           INSTITUTION_MATCH_FUZZY  #>                                                 0  #>                            INSTITUTION_MATCH_NONE  #>                                                 0  #>                           INVALID_SCIENTIFIC_NAME  #>                                                 0  #>                             LOCATION_NOT_SUPPLIED  #>                                                13  #>                           MISSING_COLLECTION_DATE  #>                                                23  #>                             MISSING_GEODETICDATUM  #>                                               599  #>                         MISSING_GEOREFERENCE_DATE  #>                                               614  #>                           MISSING_GEOREFERENCEDBY  #>                                               614  #>                      MISSING_GEOREFERENCEPROTOCOL  #>                                               614  #>                       MISSING_GEOREFERENCESOURCES  #>                                               614  #>            MISSING_GEOREFERENCEVERIFICATIONSTATUS  #>                                                 0  #>                                 MISSING_TAXONRANK  #>                                               612  #>                             MODIFIED_DATE_INVALID  #>                                                 0  #>                            MODIFIED_DATE_UNLIKELY  #>                                                 0  #>                           MULTIMEDIA_DATE_INVALID  #>                                                 0  #>                            MULTIMEDIA_URI_INVALID  #>                                                 0  #>                                 NAME_NOT_SUPPLIED  #>                                                 0  #>   OCCURRENCE_STATUS_INFERRED_FROM_BASIS_OF_RECORD  #>                                                 2  #>  OCCURRENCE_STATUS_INFERRED_FROM_INDIVIDUAL_COUNT  #>                                               384  #>                      OCCURRENCE_STATUS_UNPARSABLE  #>                                                 0  #>                         PRESUMED_NEGATED_LATITUDE  #>                                                 0  #>                        PRESUMED_NEGATED_LONGITUDE  #>                                                 0  #>                       PRESUMED_SWAPPED_COORDINATE  #>                                                 0  #>                             RECORDED_DATE_INVALID  #>                                                 2  #>                            RECORDED_DATE_MISMATCH  #>                                                 0  #>                            RECORDED_DATE_UNLIKELY  #>                                                 0  #>                            REFERENCES_URI_INVALID  #>                                                 0  #>                         STATE_COORDINATE_MISMATCH  #>                                               335  #>                            TAXON_AFFINITY_SPECIES  #>                                                 0  #>                              TAXON_CONFER_SPECIES  #>                                                 0  #>                               TAXON_DEFAULT_MATCH  #>                                                 0  #>                                       TAXON_ERROR  #>                                                 0  #>                                    TAXON_EXCLUDED  #>                                                 0  #>                         TAXON_EXCLUDED_ASSOCIATED  #>                                                 0  #>                                     TAXON_HOMONYM  #>                                                 0  #>                       TAXON_INDETERMINATE_SPECIES  #>                                                 0  #>                             TAXON_MATCH_AGGREGATE  #>                                                 0  #>                                 TAXON_MATCH_FUZZY  #>                                                 0  #>                            TAXON_MATCH_HIGHERRANK  #>                                                 0  #>                                  TAXON_MATCH_NONE  #>                                                 0  #>                                  TAXON_MISAPPLIED  #>                                                 0  #>                          TAXON_MISAPPLIED_MATCHED  #>                                                 0  #>                        TAXON_PARENT_CHILD_SYNONYM  #>                                                 0  #>                            TAXON_QUESTION_SPECIES  #>                                                 0  #>                              TAXON_SCOPE_MISMATCH  #>                                                 0  #>                              TAXON_SPECIES_PLURAL  #>                                                 0  #>                               TYPE_STATUS_INVALID  #>                                                 0  #>                          UNCERTAINTY_IN_PRECISION  #>                                               122  #>                         UNCERTAINTY_NOT_SPECIFIED  #>                                                 0  #>                              UNKNOWN_COUNTRY_NAME  #>                                                 0  #>                                   UNKNOWN_KINGDOM  #>                                                 0  #>                               userDuplicateRecord  #>                                                 0  #>                                   ZERO_COORDINATE  #>                                                 0"},{"path":"/articles/sbdi4r.html","id":"plotting-data-on-a-map","dir":"Articles","previous_headings":"NOT WORKING > change to show_all(fields)","what":"Plotting data on a map","title":"Introduction to sbdi4r2","text":"many ways producing spatial plots R.  leaflet package provides simple method producing browser-based maps panning, zooming, background layers:","code":"xf <- sbdi_call() |>    sbdi_identify(taxa) |>   atlas_occurrences() #> --   ## note this should ideally be states           data(\"swe_wgs84\", package = \"sbdi4r2\", envir = environment())      plot(swe_wgs84[[\"Border\"]]$geometry, col = \"grey\", border = NA)    points(xf$decimalLongitude, xf$decimalLatitude, pch = 19, col = \"black\") library(sf) #> Linking to GEOS 3.11.2, GDAL 3.7.2, PROJ 9.3.0; sf_use_s2() is TRUE  xf_sf <- xf |>    filter(!is.na(decimalLatitude),          !is.na(decimalLongitude)) |>    st_as_sf(coords = c(\"decimalLongitude\", \"decimalLatitude\"), crs = 4326)  plot(swe_wgs84[[\"Border\"]]$geometry, col = \"grey\", border = NA)  plot(xf_sf$geometry, pch = 19, add = TRUE) library(leaflet) ## make a link to the web page for each occurrence popup_link <- paste0(\"<a href=\\\"https://records.biodiversitydata.se/occurrences/\",                       xf_sf$recordID,\"\\\">Link to occurrence record<\/a>\")  ## blank map, with imagery background m <- leaflet() |>     addProviderTiles(\"Esri.WorldImagery\") |>   addCircleMarkers(data = xf_sf ,                     radius = 2, fillOpacity = .5, opacity = 1,                    popup = popup_link) m"},{"path":"/articles/sbdi4r.html","id":"save-data","dir":"Articles","previous_headings":"NOT WORKING > change to show_all(fields)","what":"Save data","title":"Introduction to sbdi4r2","text":"","code":"# save as data.frame Callitriche <- as.data.frame(xf)  # simplyfy data frame calli <- data.frame(Callitriche$scientificName,                     Callitriche$decimalLatitude,                     Callitriche$decimalLongitude) # simplify column names colnames(calli) <- c(\"species\",\"latitude\",\"longitude\") # remove rows with missing values (NAs) calli <- na.omit(calli)  # save new dataframe write.csv(calli, \"Callitriche.csv\")"},{"path":"/articles/sbdi4r.html","id":"example-3-summarise-occurrences-over-a-defined-grid","dir":"Articles","previous_headings":"NOT WORKING","what":"Example 3: Summarise occurrences over a defined grid","title":"Introduction to sbdi4r2","text":"Now, following data downloaded previous example, want summarise occurrences defined grid instead plotting every observation point. First need overlay observations grid. case, standard Swedish grids 50, 25, 10 5 km provided data (Coordinate Reference System = WGS84, EPSG:4326). result ObsInGridList list object subset data grid.","code":"library(sf) # load some shapes over Sweden # Political borders data(\"swe_wgs84\", package = \"sbdi4r2\", envir = environment())  # A standard 50km grid data(\"Sweden_Grid_50km_Wgs84\", package = \"sbdi4r2\", envir = environment())   grid <- Sweden_Grid_50km_Wgs84 # grid <- st_transform(grid, crs = st_crs(3006))  nObs <- nrow(xf_sf)  ## overlay the data with the grid listGrid <- st_intersects(grid, xf_sf)  ObsInGridList <- list() for (i in seq(length(listGrid))) {   if (length(listGrid[[i]]) == 0) {     ObsInGridList[[i]] <- NA   } else {     ObsInGridList[[i]] <- st_drop_geometry(xf_sf[listGrid[[i]],])   } } wNonEmpty <- which( unlist(lapply(ObsInGridList, function(x) !all(is.na(x)))) ) if (length(wNonEmpty) == 0) message(\"Observations don't overlap any grid cell.\")  ## check nObs sum(unlist(lapply(ObsInGridList, nrow))) == nObs #> [1] FALSE length(ObsInGridList) == nrow(grid) #> [1] TRUE"},{"path":"/articles/sbdi4r.html","id":"summarise","dir":"Articles","previous_headings":"NOT WORKING > Example 3: Summarise occurrences over a defined grid","what":"Summarise","title":"Introduction to sbdi4r2","text":"Now summarise occurrences within grid cells:","code":"## apply a summary over the grid nCells <- length(ObsInGridList)  res <- data.frame(\"nObs\" = as.numeric(rep(NA, nCells)),                   \"nYears\" = as.numeric(rep(NA, nCells)),                   row.names = row.names(grid),                   stringsAsFactors = FALSE)  cols2use <- c(\"scientificName\", \"eventDate\")  dataRes <- lapply(ObsInGridList[wNonEmpty], function(x){   x <- x[,cols2use]   x$year <- year(x$eventDate)   colnames(x) <- c(\"scientificName\", \"year\")      return(c(\"nObs\" = nrow(x),            \"nYears\" = length(unique(x[,\"year\"]))   )) })  dataRes <- as.data.frame(dplyr::bind_rows(dataRes, .id = \"id\"))  res[wNonEmpty,] <- dataRes[,-1] res$nObs <- as.numeric(res$nObs) resSf <- st_as_sf(cbind(res, st_geometry(grid)) ) rownames(resSf) <- grid$id"},{"path":"/articles/sbdi4r.html","id":"plotting-data-on-a-map-1","dir":"Articles","previous_headings":"NOT WORKING > Example 3: Summarise occurrences over a defined grid","what":"Plotting data on a map","title":"Introduction to sbdi4r2","text":"Finally plot grid summary map:","code":"palBW <- leaflet::colorNumeric(palette = c(\"white\", \"navyblue\"),                                domain = c(0, max(resSf$nObs, na.rm = TRUE)),                                 na.color = \"transparent\") oldpar <- par() par(mar = c(1,1,0,0)) plot(resSf$geometry, col = palBW(resSf$nObs), border = NA) plot(swe_wgs84$Border, border = 1, lwd = 1, add = T) legend(\"bottomleft\",         legend = round(seq(0, max(resSf$nObs, na.rm = TRUE), length.out = 5)),        col = palBW(seq(0, max(resSf$nObs, na.rm = TRUE), length.out = 5)),        title = \"Number of \\nobservations\", pch = 15, bty = \"n\") suppressWarnings(par(oldpar))"},{"path":"/articles/sbdi4r.html","id":"other-polygons","dir":"Articles","previous_headings":"NOT WORKING > Example 3: Summarise occurrences over a defined grid","what":"Other polygons","title":"Introduction to sbdi4r2","text":"set polygons also used summarise, example, counties. plotting map:","code":"counties <- swe_wgs84$Counties obs <- st_transform(xf_sf, crs = st_crs(counties))  ## overlay the data with the counties listGrid <- st_intersects(counties, obs)  ObsInCountyList <- list() for (i in seq(length(listGrid))) {   if (length(listGrid[[i]]) == 0) {     ObsInCountyList[[i]] <- NA   } else {     ObsInCountyList[[i]] <- st_drop_geometry(xf_sf[listGrid[[i]],])   } } wNonEmpty <- which( unlist(lapply(ObsInCountyList, function(x) !all(is.na(x)))) ) if (length(wNonEmpty) == 0) message(\"Observations don't overlap any grid cell.\")  ## check nObs sum(unlist(lapply(ObsInCountyList, nrow))) == nObs # some observations are not in the counties territory #> [1] FALSE length(ObsInCountyList) == nrow(counties) #> [1] TRUE  ## apply a summary over the grid nCells <- length(ObsInCountyList)  res <- data.frame(\"nObs\" = as.numeric(rep(NA, nCells)),                   \"nYears\" = as.numeric(rep(NA, nCells)),                   stringsAsFactors = FALSE)  cols2use <- c(\"scientificName\", \"eventDate\")  dataRes <- lapply(ObsInCountyList[wNonEmpty], function(x){   x <- x[,cols2use]   x$year <- year(x$eventDate)   colnames(x) <- c(\"scientificName\", \"year\")      return(c(\"nObs\" = nrow(x),            \"nYears\" = length(unique(x[,\"year\"]))   )) })   dataRes <- as.data.frame(dplyr::bind_rows(dataRes, .id = \"id\")) res[wNonEmpty,] <- dataRes[,-1] res$nObs <- as.numeric(res$nObs)  resSf <- st_as_sf(cbind(res, st_geometry(counties))) rownames(resSf) <- counties$LnNamn palBW <- leaflet::colorNumeric(c(\"white\", \"navyblue\"),                                 c(0, max(resSf$nObs, na.rm = TRUE)),                                 na.color = \"transparent\") oldpar <- par() par(mar = c(1,1,0,0)) plot(resSf$geometry, col = palBW(resSf$nObs), border = NA) plot(swe_wgs84$Border, border = 1, lwd = 1, add = T) text(st_coordinates(st_centroid(counties)),      labels = as.character(counties$LnNamn), font = 2, cex = .5 ) legend(\"bottomleft\",         legend = round(seq(0, max(resSf$nObs, na.rm = TRUE), length.out = 5)),        col = palBW(seq(0, max(resSf$nObs, na.rm = TRUE), length.out = 5)),        title = \"Number of \\nobservations\", pch = 15, bty = \"n\") suppressWarnings(par(oldpar))"},{"path":"/articles/sbdi4r.html","id":"add-the-county-name-to-each-observation","dir":"Articles","previous_headings":"NOT WORKING > Example 3: Summarise occurrences over a defined grid","what":"Add the county name to each observation","title":"Introduction to sbdi4r2","text":"clear image observations outside territorial extent county may within counties water bodies coastal areas.","code":"countiesLab <- as.character(counties$LnNamn) ## Add a column to the obs data.frame to hold the id of the overlapped polygon,  ## in this case, Län (county) and plot which observation didn't fall with any  ## territory. obs$county <- countiesLab[as.integer(st_intersects(obs, counties))]  oldpar <- par() par(mar = c(1,1,0,0)) plot(counties$geometry, border = 1, lwd = 1) plot(obs$geometry[which(is.na(obs$county))],       pch = 19, cex = .5, col = \"red\", add = T) suppressWarnings(par(oldpar))"},{"path":"/articles/sbdi4r.html","id":"example-4-area-search-and-report--what-listed-species-exist-in-a-given-area","dir":"Articles","previous_headings":"NOT WORKING","what":"Example 4: Area search and report. What listed species exist in a given area?","title":"Introduction to sbdi4r2","text":"work set valid filepath, create object class SpatialPolygon. instead use data kindly provided package data(\"swe\"). create WKT string using rgeos library: Unfortunately, instance gives WKT string long won’t accepted web service. Also, shapefile just got projected coordinate system SWEREF99 TM, web service accepts coordinates geodesic coordinate system WGS84. Instead, let’s construct WKT string directly, gives us little control format: Now extract species list polygon:","code":"shape <- st_read(dsn = file.path(\"your/path/to/file\", \"Kommun_Sweref99TM_region.shp\")) shape <- swe$Municipalities ## extract just the Municipality of Örebro shape <- shape[shape$KnNamn == \"Örebro\", ] wkt <- shape |>    st_transform(crs = st_crs(4326)) |>    st_geometry() |>    st_as_text() shape <- st_transform(shape,                       crs = st_crs(4326)) shape <- st_union(shape)  ## extract the convex hull of the polygon to reduce the length of the WKT string shape_ch <- st_convex_hull(shape)  # cast it as MULTIPOLYGON as this is what SBDIs API need # NOTE: as of today, the SBDI APIs will only work properly if the polygon is  # submitted as a MULTIPOLYGON shape_ch <- st_cast(shape_ch, to = \"POLYGON\")  # create WKT string wkt <- st_as_text(shape_ch) sbdi_call() |>   sbdi_identify(\"amphibia\") |>   sbdi_geolocate(wkt) |>   filter(taxonRank == \"species\") |>    atlas_occurrences() |>    group_by(taxonConceptID, scientificName) |>    reframe(count = n()) #> [1] \"could not find function \\\"reframe\\\"\""},{"path":"/articles/sbdi4r.html","id":"example-5-community-composition-and-turnover","dir":"Articles","previous_headings":"NOT WORKING","what":"Example 5: Community composition and turnover","title":"Introduction to sbdi4r2","text":"Define area interest transect running westwards Stockholm region, download occurrences legumes (Fabaceae; large family flowering plants) area: Convert sites--species data.frame: end result: Now can start examine patterns data. Let’s plot richness function longitude:  Species richness function environment:  seem like higher species richness hottest areas. community composition change along transect? Use clustering:","code":"## A rough polygon around the Mällardalen wkt <- \"POLYGON((14.94 58.88, 14.94 59.69, 18.92 59.69, 18.92 58.88, 14.94 58.88))\"  ## define some environmental layers of interest [see sbdi_fields(fields_type = \"occurrence\")] # el10009 WorldClim Mean Temperature of Warmest Quarter https://spatial.biodiversitydata.se/ws/layers/view/more/worldclim_bio_10 # el10011 WorldClim Annual Precipitation https://spatial.biodiversitydata.se/ws/layers/view/more/worldclim_bio_12 env_layers <- c(\"el10009\",\"el10011\")   ## Download the data.  We use the `occurrences()` function, adding environmental ## data via the 'extra' parameter.  x <- sbdi_call() |>   sbdi_identify(\"Fabaceae\") |>   sbdi_geolocate(wkt) |>   filter(taxonRank == \"species\") |>    select(recordID, scientificName, taxonConceptID, taxonRank,           decimalLatitude, decimalLongitude,          eventDate, occurrenceStatus, all_of(env_layers)) |>    atlas_occurrences() library(tidyverse) xgridded <- x |>      ## discard genus- and higher-level records     filter(taxonRank %in%              c(\"species\", \"subspecies\", \"variety\", \"form\", \"cultivar\")) |>      mutate(longitude = round(decimalLongitude * 5)/5,             latitude = round(decimalLatitude * 5)/5,             el10009 = el10009 /10) %>%     ## average environmental vars within each bin     group_by(longitude,latitude) %>%     mutate(annPrec = mean(el10011, na.rm=TRUE),            meanTempWarmQuart = mean(el10009, na.rm=TRUE)) |>      ## subset to vars of interest     select(longitude, latitude, scientificName, annPrec, meanTempWarmQuart) |>      ## take one row per cell per species (presence)     distinct() |>      ## calculate species richness     mutate(richness = n()) |>      ## convert to wide format (sites by species)     mutate(present = 1) |>      do(spread(data =., key = scientificName, value = present, fill = 0)) |>      ungroup()  ## where a species was not present, it will have NA: convert these to 0 sppcols <- setdiff(names(xgridded),                    c(\"longitude\", \"latitude\",                       \"annPrec\",                       \"meanTempWarmQuart\",                      \"richness\")) xgridded <- xgridded |>    mutate_at(sppcols, function(z) ifelse(is.na(z), 0, z)) saveRDS(xgridded, file = \"vignette_fabaceae.rds\") xgridded[, 1:10] #> # A tibble: 100 × 10 #>    longitude latitude annPrec meanTempWarmQuart richness `Anthyllis vulneraria` #>        <dbl>    <dbl>   <dbl>             <dbl>    <int>                  <dbl> #>  1      15       58.8    632.              15.2       18                      1 #>  2      15       59      630.              15.4       35                      1 #>  3      15       59.2    642.              15.5       31                      1 #>  4      15       59.4    658.              15.3       32                      1 #>  5      15       59.6    682.              15.2       30                      1 #>  6      15.2     58.8    631.              15.2       21                      1 #>  7      15.2     59      627.              15.4       34                      1 #>  8      15.2     59.2    628.              15.7       56                      1 #>  9      15.2     59.4    644.              15.7       32                      1 #> 10      15.2     59.6    669.              15.4       28                      1 #> # ℹ 90 more rows #> # ℹ 4 more variables: `Astragalus glycyphyllos` <dbl>, #> #   `Lathyrus linifolius` <dbl>, `Lathyrus pratensis` <dbl>, #> #   `Lathyrus sylvestris` <dbl> library(ggplot2) ggplot(xgridded, aes(longitude, richness)) +    labs(x = \"Longitud (º)\",         y = \"Species richness\") +   lims(y = c(0,100)) +   geom_point() +    theme_bw() ggplot(xgridded, aes(meanTempWarmQuart, annPrec,                       colour = richness)) +   labs(x = \"Mean temperature of warmest quarter (ºC)\" ,         y = \"Annual precipitation (mm)\",        colour = \"Species \\nrichness\") +    scale_colour_distiller(palette = \"Spectral\") +   geom_point(size=3) +    theme_bw() library(vegan) ## Bray-Curtis dissimilarity D <- vegdist(xgridded[, sppcols], \"bray\") ## UPGMA clustering cl <- hclust(D, method = \"ave\") ## plot the dendrogram plot(cl) ## extract group labels at the 5-group level grp <- cutree(cl, 5) ## coalesce small (outlier) groups into a single catch-all group sing <- which(table(grp) < 5) # grp[grp %in% sing] <- 6 ## put these in a new combined group grp <- sapply(grp, function(z)which(unique(grp) == z)) ## renumber groups xgridded$grp <- as.factor(grp) ## plot ## colours for clusters thiscol <- c(\"#1f77b4\", \"#ff7f0e\", \"#2ca02c\", \"#d62728\", \"#9467bd\", \"#8c564b\",               \"#e377c2\", \"#7f7f7f\", \"#bcbd22\", \"#17becf\") ggplot(xgridded, aes(longitude, latitude, colour = grp)) +    labs(x = \"Longitude\", y = \"Latitude\", colour = \"Group\") +    geom_point(size = 3) +   scale_colour_manual(values = thiscol) +    theme_bw() ## or a slightly nicer map plot library(maps) library(mapdata) oldpar <- par() par(mar = c(1,1,0,0)) map(\"worldHires\", \"Sweden\",      xlim = c(14.5, 20), ylim = c(58.8, 59.95),      col = \"gray90\", fill = TRUE) with(xgridded, points(longitude, latitude,                        pch = 21, col = thiscol[grp],                        bg = thiscol[grp], cex = 0.75)) suppressWarnings(par(oldpar))"},{"path":"/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Debora Arlt. Author, maintainer. Alejandro Ruete. Author. Manash Shah. Contributor.","code":""},{"path":"/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Arlt D, Ruete (2024). sbdi4r2: Swedish Biodiversity Data Infrastructure Data Resources R. R package version 1.0.0, https://github.com/biodiversitydata-se/sbdi4r2/.","code":"@Manual{,   title = {sbdi4r2: Swedish Biodiversity Data Infrastructure Data and Resources in R},   author = {Debora Arlt and Alejandro Ruete},   year = {2024},   note = {R package version 1.0.0},   url = {https://github.com/biodiversitydata-se/sbdi4r2/}, }"},{"path":[]},{"path":"/index.html","id":"r-functionality-for-the-sbdi-data-portal","dir":"","previous_headings":"","what":"R functionality for the SBDI data portal","title":"Swedish Biodiversity Data Infrastructure Data and Resources in R","text":"Swedish Biodiversity Data Infrastructure (SBDI) provides tools enable users biodiversity information find, access, combine visualize data Swedish plants animals; available SBDI. R package sbdi4r2 provides subset tools, extension tools (found previously Analysportalen.se), directly used within R. sbdi4r2 enables R community directly access data resources hosted SBDI. goal enable observations species queried output range standard formats. tool built Atlas Living Australia platform wrapping galah package provides similar services ALA. Use-examples available package vignette , via (R): vignette(\"sbdi4r2\"). questions please get contact us via support center.","code":""},{"path":"/index.html","id":"installing-sbdi4r2","dir":"","previous_headings":"","what":"Installing sbdi4r2","title":"Swedish Biodiversity Data Infrastructure Data and Resources in R","text":"package yet available CRAN therefore installed GitHub repository. R: development version GitHub: {r} install.packages(\"remotes\")  remotes::install_github(\"biodiversitydata-se/sbdi4r2\")","code":""},{"path":"/index.html","id":"windows","dir":"","previous_headings":"Installing sbdi4r2","what":"Windows","title":"Swedish Biodiversity Data Infrastructure Data and Resources in R","text":"see error “ERROR: lazy loading failed package ‘sbdi4r2’”, may due trying install network location. Try instead install local location: first create local location want use, specify location installing, later loading package: {r} install_github(\"biodiversitydata-se/sbdi4r2\", lib = \"C:/pathname/MyLibrary\") library(sbdi4r2, lib.loc = \"C:/pathname/MyLibrary\")","code":""},{"path":"/index.html","id":"mac","dir":"","previous_headings":"Installing sbdi4r2","what":"Mac","title":"Swedish Biodiversity Data Infrastructure Data and Resources in R","text":"see error failure set default locale, need manually set : {r} system('defaults write org.R-project.R force.LANG en_US.UTF-8') restart R. information can found CRAN R Mac page.","code":""},{"path":"/index.html","id":"linux","dir":"","previous_headings":"Installing sbdi4r2","what":"Linux","title":"Swedish Biodiversity Data Infrastructure Data and Resources in R","text":"First, ensure libcurl installed system — e.g. Ubuntu, open terminal : install libcurl4-openssl-dev via Software Centre. , R shown .","code":"sudo apt-get install libcurl4-openssl-dev"},{"path":"/index.html","id":"using-sbdi4r2","dir":"","previous_headings":"","what":"Using sbdi4r2","title":"Swedish Biodiversity Data Infrastructure Data and Resources in R","text":"sbdi4r2 package must loaded new R session library(sbdi4r2), specifying local location library(sbdi4r2, lib.loc = \"C:/pathname/MyLibrary\").","code":""},{"path":"/index.html","id":"customizing-sbdi4r2","dir":"","previous_headings":"","what":"Customizing sbdi4r2","title":"Swedish Biodiversity Data Infrastructure Data and Resources in R","text":"Various aspects sbdi4r2 package can customized.","code":""},{"path":"/index.html","id":"e-mail-address","dir":"","previous_headings":"Customizing sbdi4r2","what":"E-mail address","title":"Swedish Biodiversity Data Infrastructure Data and Resources in R","text":"download request SBDI servers also accompanied “e-mail address” string identifies user making request. need provide email address registered SBDI. can create account . email registered SBDI, stored config: {r} sbdi_config(email = \".valid@emailaddress.com\")","code":""},{"path":"/index.html","id":"debugging","dir":"","previous_headings":"Customizing sbdi4r2","what":"Debugging","title":"Swedish Biodiversity Data Infrastructure Data and Resources in R","text":"things aren’t working expected, detail (particularly web requests caching behaviour) can obtained setting verbose configuration option: {r} sbdi_config(verbose = TRUE)","code":""},{"path":"/index.html","id":"setting-the-download-reason","dir":"","previous_headings":"Customizing sbdi4r2","what":"Setting the download reason","title":"Swedish Biodiversity Data Infrastructure Data and Resources in R","text":"SBDI requires provide reason downloading occurrence data (via sbdi4r2 occurrences() function). can provide parameter directly call occurrences(), can set per session using: {r} sbdi_config(download_reason_id = \"your_reason_id\") (See sbdi_reasons() valid download reasons, e.g. download_reason_id=10 “testing”, 7 “ecological research”, 8 “systematic research/taxonomy”, 3 “education”)","code":""},{"path":[]},{"path":"/reference/sbdi4r2.html","id":null,"dir":"Reference","previous_headings":"","what":"Biodiversity Data from the GBIF Node Network\r\nsbdi4r2 — sbdi4r2","title":"Biodiversity Data from the GBIF Node Network\r\nsbdi4r2 — sbdi4r2","text":"project enables R community access data tools hosted Swedish Biodiversity Data Infrastructure (SBDI). goal project enable basic species related information queried output standard formats R. `sbdi4r2` based around extensive web services provided Swedish Biodiversity Data Infrastructure; see API link . Global Biodiversity Information Facility (GBIF; <https://www.gbif.org>) provides tools enable users find, access, combine visualise biodiversity data. `sbdi4r2` (via `galah`) enables R community directly access data resources hosted GBIF several subsidiary organisations, known 'nodes'. basic unit observation stored infrastructures **occurrence** record, based Darwin Core' data standard (<https://dwc.tdwg.org>); however `galah` also enables users locate download taxonomic information, associated media images sounds, restricting queries particular taxa locations. Users can specify columns returned query, restrict results observations meet particular quality-control criteria.","code":""},{"path":"/reference/sbdi4r2.html","id":"functions","dir":"Reference","previous_headings":"","what":"Functions","title":"Biodiversity Data from the GBIF Node Network\r\nsbdi4r2 — sbdi4r2","text":"**Piping functions** * [sbdi_call()] request_() et al.  Start build data query   * collapse() Generate query   * compute() Compute query   * collect() Retrieve database query **Look information** * [search_taxa()] Search taxa using text-search   * [search_identifiers()] Search taxa using taxonomic identifiers   * [show_all()] & [search_all()] Data generating filter queries   * [show_values()] & [search_values()] Show search values _within_   `fields`, `profiles`, `lists`, `collections`, `datasets` `providers` **Lazy data manipulation** * identify() [sbdi_identify()] Search taxonomic identifiers   * filter() [sbdi_filter()]Filter records   * select() [sbdi_select()]Fields report information   * group_by() [sbdi_group_by()] Fields group counts   * st_crop() [sbdi_geolocate()] Specify location   * [apply_profile()] [sbdi_apply_profile()] Restrict data pass predefined checks (ALA )   * slice_head() Choose first n rows download   * arrange() Arrange rows query server side **Download data** * [atlas_occurrences()] Download occurrence records   * [atlas_counts()] count() Count number records species returned query   * [atlas_species()] Download species lists   * [atlas_taxonomy()] Return section ALA taxonomic tree   * [atlas_media()] View images sounds available download   * [collect_media()] Download images sounds **Configure session** * [sbdi_config()] Package configuration options **Cite** * [atlas_citation()] Citation dataset","code":""},{"path":"/reference/sbdi4r2.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Biodiversity Data from the GBIF Node Network\r\nsbdi4r2 — sbdi4r2","text":"https://api.biodiversitydata.se/","code":""},{"path":[]},{"path":"/reference/sbdi4r2.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Biodiversity Data from the GBIF Node Network\r\nsbdi4r2 — sbdi4r2","text":"Maintainer: Debora Arlt debora.arlt@slu.se Authors: Alejandro Ruete contributors: Manash Shah [contributor]","code":""},{"path":"/reference/sbdi_apply_profile.html","id":null,"dir":"Reference","previous_headings":"","what":"Apply a data quality profile — sbdi_apply_profile","title":"Apply a data quality profile — sbdi_apply_profile","text":"'profile' group filters pre-applied ALA. Using data profile allows query filtered quickly relevant quality-assured data fit--purpose. example, \"ALA\" profile designed exclude lower quality records, whereas profiles apply filters specific species distribution modelling (e.g. CDSM).","code":""},{"path":"/reference/sbdi_apply_profile.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Apply a data quality profile — sbdi_apply_profile","text":"","code":"sbdi_apply_profile(...)"},{"path":"/reference/sbdi_apply_profile.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Apply a data quality profile — sbdi_apply_profile","text":"... profile name. `string` - name abbreviation data quality profile apply query. Valid values can seen using `show_all(profiles)`","code":""},{"path":"/reference/sbdi_apply_profile.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Apply a data quality profile — sbdi_apply_profile","text":"tibble containing valid data profile value.","code":""},{"path":"/reference/sbdi_apply_profile.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Apply a data quality profile — sbdi_apply_profile","text":"Note one profile can loaded time; multiple profiles given, first valid profile used. bespoke editing filters within profile, use [sbdi_filter()]","code":""},{"path":[]},{"path":"/reference/sbdi_apply_profile.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Apply a data quality profile — sbdi_apply_profile","text":"","code":"if (FALSE) { # Apply a data quality profile to a query sbdi_call() |>   sbdi_identify(\"reptilia\") |>     filter(year == 2021) |>       sbdi_apply_profile(ALA) |>         atlas_counts()  }"},{"path":"/reference/sbdi_call.html","id":null,"dir":"Reference","previous_headings":"","what":"Start building a query — sbdi_call","title":"Start building a query — sbdi_call","text":"download data selected atlas, one must construct query. query tells atlas API data download return, well filtered. Using `sbdi_call()` allows build piped query download data, way wrangle data `dplyr` `tidyverse`. `sbdi_call()` wrapper group underlying `request_` functions `galah` package. functions can begin piped query end `collapse()`, `compute()` `collect()`. underlying `request_` #' functions useful allow `sbdi4r2` `galah` separate different types requests perform better. example, `filter.data_request` translates filters R `solr`, whereas `filter.metadata_request` searches using search term. details see object-oriented programming vignette: vignette(\"object_oriented_programming\", package = \"galah\")","code":""},{"path":"/reference/sbdi_call.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Start building a query — sbdi_call","text":"","code":"sbdi_call(method = c(\"data\", \"metadata\", \"files\"), type, ...)"},{"path":"/reference/sbdi_call.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Start building a query — sbdi_call","text":"method string: `request` function called. one `\"data\"` (default), `\"metadata\"` `\"files\"` type string: form data returned? Acceptable values specified corresponding `request` function ... Zero arguments alter query. See 'details'.","code":""},{"path":"/reference/sbdi_call.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Start building a query — sbdi_call","text":"sub-function returns different object class: `request_data()` returns `data_request`. `request_metadata` returns `metadata_request`, `request_files()` returns `files_request`.","code":""},{"path":"/reference/sbdi_call.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Start building a query — sbdi_call","text":"atlas several types data can chosen. Currently supported `\"occurrences\"` (default), `\"species\"` (`\"media\"` ALA). also possible use  `type = \"occurrences-count\"` `type = \"species-count\"`; practice synonymous `sbdi_call() |> count()`, therefore practically useful debugging (via `collapse()` `compute()`). named arguments supported via `...`. practice, functions `sbdi_` prefix (`galah_` matter) S3 methods ported `dplyr` assign information correct slots internally. Overwriting user-defined alternatives possible, advised. Accepted arguments : - `filter` (accepts `sbdi_filter()` filter())  - `select` (accepts `sbdi_select()` select)  - `group_by` (accepts `sbdi_group_by()` group_by())  - `identify` (accepts `sbdi_identify()` identify())  - `geolocate` (accepts `sbdi_geolocate()`, `sbdi_polygon()` `sbdi_bbox()`    st_crop())  - `limit` (accepts slice_head())  - `doi` (accepts sting listing valid DOI, specific `collect()` `type = \"doi\"`) Unrecognised names ignored `collect()` related functions.","code":""},{"path":[]},{"path":"/reference/sbdi_call.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Start building a query — sbdi_call","text":"","code":"if (FALSE) { # Begin your query with `sbdi_call()`, then pipe using `%>%` or `|>`  # Get number of records of *Aves* from 2001 to 2004 by year sbdi_call() |>   sbdi_identify(\"Aves\") |>   sbdi_filter(year > 2000 & year < 2005) |>   sbdi_group_by(year) |>   atlas_counts()  # Get information for all species in *Cacatuidae* family sbdi_call() |>   sbdi_identify(\"Cacatuidae\") |>   atlas_species()  # Download records of genus *Eolophus* from 2001 to 2004 sbdi_config(email = \"your-email@email.com\")  sbdi_call() |>   sbdi_identify(\"Eolophus\") |>   sbdi_filter(year > 2000 & year < 2005) |>   atlas_occurrences()  }"},{"path":"/reference/sbdi_config.html","id":null,"dir":"Reference","previous_headings":"","what":"Get or set configuration options that control sbdi4r2 behavior — sbdi_config","title":"Get or set configuration options that control sbdi4r2 behavior — sbdi_config","text":"Get set configuration options control sbdi4r2 behavior List valid download reasons","code":""},{"path":"/reference/sbdi_config.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get or set configuration options that control sbdi4r2 behavior — sbdi_config","text":"","code":"sbdi_config(atlas = \"SBDI\", ...)  sbdi_reasons()"},{"path":"/reference/sbdi_config.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get or set configuration options that control sbdi4r2 behavior — sbdi_config","text":"atlas string: Living Atlas point , SBDI default. Can organisation name,  acronym, region (see [show_all_atlases()] admissible values). ... Options can defined using form `name = \"value\"`. Valid arguments : *  `api-key` string: registered API key (currently unused). *  `directory` string: directory use cache.  default temporary directory, means results  cached within R session cleared automatically user exits R.  user may wish set non-temporary directory  caching across sessions. directory must exist file system. *  `download_reason_id` numeric string: \"download reason\" required  ALA services, either numeric ID (currently 0--13)  string (see `show_all(reasons)` list valid ID codes  names). default NA. ALA services require valid  download_reason_id code, either specified directly  associated R function. *  `email` string: email address registered chosen  atlas. SBDI, can register  [address](https://auth.biodiversitydata.se/userdetails/registration/createAccount). *  `password` string: registered password (GBIF ) *  `run_checks` logical: `sbdi4r2` run checks filters  columns. making lots requests sequentially, checks can slow  process lead HTTP 500 errors, turned . Defaults  TRUE. *  `send_email` logical: receive email query  [atlas_occurrences()]? Defaults `FALSE`; can  useful instances, example tracking DOIs assigned  specific downloads later citation. *  `username` string: registered username (GBIF ) *  `verbose` logical: `sbdi4r2` give verbose progress bars? Defaults FALSE.","code":""},{"path":"/reference/sbdi_config.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get or set configuration options that control sbdi4r2 behavior — sbdi_config","text":"`sbdi_config()`, `list` options. `sbdi_config(...)` called arguments, nothing returned configuration set.","code":""},{"path":"/reference/sbdi_config.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Get or set configuration options that control sbdi4r2 behavior — sbdi_config","text":"https://api.biodiversitydata.se/ https://spatial.biodiversitydata.se/layers/ eventually move api link #' `sbdi4r2` package (via `galah` package) supports large data downloads, also interfaces SBDI requires users services provide registered email address reason downloading data. `sbdi_config` function provides way manage issues simply possible. Invoking sbdi_config() arguments returns list current values options. sbdi_reasons() returns data frame information describing valid options download_reason_id","code":""},{"path":"/reference/sbdi_config.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Get or set configuration options that control sbdi4r2 behavior — sbdi_config","text":"","code":"if (FALSE) { # To download occurrence records, enter your email in `sbdi_config()`. # This email should be registered with the atlas in question. sbdi_config(email = \"your-email@email.com\")  # Some ALA services require that you add a reason for downloading data. # Add your selected reason using the option `download_reason_id` sbdi_config(download_reason_id = 0)  # To look up all valid reasons to enter, use `show_all(reasons)` # show_all(reasons) or simply `show_reasons()`  # Make debugging in your session easier by setting `verbose = TRUE` sbdi_config(verbose = TRUE) }"},{"path":"/reference/sbdi_geolocate.html","id":null,"dir":"Reference","previous_headings":"","what":"Narrow a query to within a specified area — sbdi_bbox","title":"Narrow a query to within a specified area — sbdi_bbox","text":"Restrict results specified area using `sbdi_geolocate()`. Areas can specified either polygons bounding boxes, depending `type`. Alternatively, users can call underlying functions directly via `sbdi_bbox()` `sbdi_polygon()`. Finally, possible use `sf` syntax calling `st_crop()`, synonymous `sbdi_polygon()`.","code":""},{"path":"/reference/sbdi_geolocate.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Narrow a query to within a specified area — sbdi_bbox","text":"","code":"sbdi_bbox(...)  sbdi_geolocate(..., type = c(\"polygon\", \"bbox\"))  sbdi_polygon(...)"},{"path":"/reference/sbdi_geolocate.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Narrow a query to within a specified area — sbdi_bbox","text":"... single `sf` object, WKT string shapefile. Bounding boxes can supplied `tibble`/`data.frame` `bbox` type `string`: one `c(\"polygon\", \"bbox\")`. Defaults `\"polygon\"`. `type = \"polygon\"`, multipolygon built via [sbdi_polygon()]. `type = \"bbox\"`, multipolygon built via [sbdi_bbox()]. multipolygon used narrow query ALA.","code":""},{"path":"/reference/sbdi_geolocate.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Narrow a query to within a specified area — sbdi_bbox","text":"length-1 string (class `character`) containing multipolygon WKT string representing area provided.","code":""},{"path":"/reference/sbdi_geolocate.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Narrow a query to within a specified area — sbdi_bbox","text":"calling `sbdi_geolocate()`, default `type` `\"polygon\"`, narrows queries within area supplied `POLYGON`. Polygons must specified either `sf` object, 'well-known text' (WKT) string, shapefile. Shapefiles must simple accepted ALA. Alternatively, set `type = \"bbox\"` narrow queries within bounding box. Bounding boxes can extracted supplied `sf` object shapefile. bounding box can also supplied `bbox` object (via `sf::st_bbox()`) `tibble`/`data.frame`. `type = \"polygon\"`, WKT strings longer 10000 characters `sf` objects 500 vertices accepted ALA. polygons  may need simplified. `type = \"bbox\"`, sf objects shapefiles converted bounding box query ALA.","code":""},{"path":"/reference/sbdi_geolocate.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Narrow a query to within a specified area — sbdi_bbox","text":"","code":"if (FALSE) { # Search for records within a polygon using a shapefile location <- sf::st_read(\"path/to/shapefile.shp\") sbdi_call() |>   sbdi_identify(\"vulpes\") |>   sbdi_geolocate(location) |>   atlas_counts()  # Search for records within the bounding box of a shapefile location <- sf::st_read(\"path/to/shapefile.shp\") sbdi_call() |>   sbdi_identify(\"vulpes\") |>   sbdi_geolocate(location, type = \"bbox\") |>   atlas_counts()  # Search for records within a polygon using an `sf` object location <- \"POLYGON((142.3 -29.0,142.7 -29.1,142.7 -29.4,142.3 -29.0))\" |>  sf::st_as_sfc() sbdi_call() |>   sbdi_identify(\"reptilia\") |>   sbdi_polygon(location) |>   atlas_counts()  # Alternatively, we can use `st_crop()` as a synonym for `sbdi_polygon()`. # Hence the above example can be rewritten as: request_data() |>   identify(\"reptilia\") |>   st_crop(location) |>   count() |>   collect()  # Search for records using a Well-known Text string (WKT) wkt <- \"POLYGON((142.3 -29.0,142.7 -29.1,142.7 -29.4,142.3 -29.0))\" sbdi_call() |>   sbdi_identify(\"vulpes\") |>   sbdi_geolocate(wkt) |>   atlas_counts()  # Search for records within the bounding box extracted from an `sf` object location <- \"POLYGON((142.3 -29.0,142.7 -29.1,142.7 -29.4,142.3 -29.0))\" |>   sf::st_as_sfc() sbdi_call() |>   sbdi_identify(\"vulpes\") |>   sbdi_geolocate(location, type = \"bbox\") |>   atlas_counts()  # Search for records using a bounding box of coordinates b_box <- sf::st_bbox(c(xmin = 143, xmax = 148, ymin = -29, ymax = -28),                      crs = sf::st_crs(\"WGS84\")) sbdi_call() |>   sbdi_identify(\"reptilia\") |>   sbdi_geolocate(b_box, type = \"bbox\") |>   atlas_counts()  # Search for records using a bounding box in a `tibble` or `data.frame` b_box <- tibble::tibble(xmin = 148, ymin = -29, xmax = 143, ymax = -21) sbdi_call() |>   sbdi_identify(\"vulpes\") |>   sbdi_geolocate(b_box, type = \"bbox\") |>   atlas_counts() }"},{"path":"/reference/sbdi_group_by.html","id":null,"dir":"Reference","previous_headings":"","what":"Specify fields to group when downloading record counts — sbdi_group_by","title":"Specify fields to group when downloading record counts — sbdi_group_by","text":"`count.data_request()` `atlas_counts()` support server-side grouping data. Grouping can used return record counts grouped multiple, valid fields (found `search_all(fields)`).","code":""},{"path":"/reference/sbdi_group_by.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Specify fields to group when downloading record counts — sbdi_group_by","text":"","code":"sbdi_group_by(...)"},{"path":"/reference/sbdi_group_by.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Specify fields to group when downloading record counts — sbdi_group_by","text":"... zero individual column names include","code":""},{"path":"/reference/sbdi_group_by.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Specify fields to group when downloading record counts — sbdi_group_by","text":"arguments provided, returns `data.frame` columns `name` `type`, per [select.data_request()].","code":""},{"path":"/reference/sbdi_group_by.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Specify fields to group when downloading record counts — sbdi_group_by","text":"","code":"if (FALSE) { sbdi_call() |>   sbdi_group_by(basisOfRecord) |>   atlas_counts() }"},{"path":"/reference/sbdi_identify.html","id":null,"dir":"Reference","previous_headings":"","what":"Narrow a query by passing taxonomic identifiers — sbdi_identify","title":"Narrow a query by passing taxonomic identifiers — sbdi_identify","text":"conducting search creating data query, common identify known taxon group taxa narrow records results returned.","code":""},{"path":"/reference/sbdi_identify.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Narrow a query by passing taxonomic identifiers — sbdi_identify","text":"","code":"sbdi_identify(...)"},{"path":"/reference/sbdi_identify.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Narrow a query by passing taxonomic identifiers — sbdi_identify","text":"... One scientific names.","code":""},{"path":"/reference/sbdi_identify.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Narrow a query by passing taxonomic identifiers — sbdi_identify","text":"tibble containing identified taxa.","code":""},{"path":"/reference/sbdi_identify.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Narrow a query by passing taxonomic identifiers — sbdi_identify","text":"`sbdi_identify()` used identify taxa want returned search data query. Users pass scientific names taxonomic identifiers pipes provide data biological group interest. good use [search_taxa()] [search_identifiers()] first check taxa provide `sbdi_identify()` return correct results.","code":""},{"path":[]},{"path":"/reference/sbdi_identify.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Narrow a query by passing taxonomic identifiers — sbdi_identify","text":"","code":"if (FALSE) { # Specify a taxon. A valid taxon will return an identifier. sbdi_identify(\"reptilia\")  # Specify more than one taxon at a time. sbdi_identify(\"reptilia\", \"mammalia\", \"aves\", \"pisces\")  # Use `sbdi_identify()` to narrow your queries sbdi_call() |>   sbdi_identify(\"Eolophus\") |>   atlas_counts()  # Within a pipe, `identify()` and `sbdi_identify()` are synonymous. # hence the following is identical to the previous example: request_data() |>   identify(\"Eolophus\") |>   count() |>   collect()  # If you know a valid taxon identifier, use `sbdi_filter()` instead. id <- \"https://biodiversity.org.au/afd/taxa/009169a9-a916-40ee-866c-669ae0a21c5c\" sbdi_call() |>   sbdi_filter(lsid == id) |>   atlas_counts() }"},{"path":"/reference/sbdi_select.html","id":null,"dir":"Reference","previous_headings":"","what":"Specify fields for occurrence download — sbdi_select","title":"Specify fields for occurrence download — sbdi_select","text":"GBIF partner nodes store content hundreds different fields, users often require thousands millions records time. reduce time taken download data, limit complexity resulting `tibble`, sensible restrict fields returned [atlas_occurrences()]. function allows easy selection fields, commonly-requested groups columns, following syntax shared `dplyr::select()`. full list available fields can viewed `show_all(fields)`. Note `select()` `sbdi_select()` supported atlases allow downloads, exception GBIF, columns returned.","code":""},{"path":"/reference/sbdi_select.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Specify fields for occurrence download — sbdi_select","text":"","code":"sbdi_select(..., group)"},{"path":"/reference/sbdi_select.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Specify fields for occurrence download — sbdi_select","text":"... zero individual column names include group `string`: (optional) name one column groups include. Valid options `\"basic\"`, `\"event\"` `\"assertions\"`","code":""},{"path":"/reference/sbdi_select.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Specify fields for occurrence download — sbdi_select","text":"tibble specifying name type column include call `atlas_counts()` `atlas_occurrences()`.","code":""},{"path":"/reference/sbdi_select.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Specify fields for occurrence download — sbdi_select","text":"Calling argument `group = \"basic\"` returns following columns: * `decimalLatitude`   * `decimalLongitude`   * `eventDate`   * `scientificName`   * `taxonConceptID`   * `recordID`   * `dataResourceName`   * `occurrenceStatus` Using `group = \"event\"` returns following columns: * `eventRemarks`   * `eventTime`   * `eventID`   * `eventDate`   * `samplingEffort`   * `samplingProtocol` Using `group = \"media\"` returns following columns: * `multimedia`   * `multimediaLicence`   * `images`   * `videos`   * `sounds` Using `group = \"assertions\"` returns quality assertion-related columns. list assertions shown `show_all_assertions()`.","code":""},{"path":[]},{"path":"/reference/sbdi_select.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Specify fields for occurrence download — sbdi_select","text":"","code":"if (FALSE) { # Download occurrence records of *Perameles*, # Only return scientificName and eventDate columns sbdi_config(email = \"your-email@email.com\") sbdi_call() |>   sbdi_identify(\"perameles\")|>   sbdi_select(scientificName, eventDate) |>   atlas_occurrences()  # Only return the \"basic\" group of columns and the basisOfRecord column sbdi_call() |>   sbdi_identify(\"perameles\") |>   sbdi_select(basisOfRecord, group = \"basic\") |>   atlas_occurrences()  # When used in a pipe, `sbdi_select()` and `select()` are synonymous. # Hence the previous example can be rewritten as: request_data() |>   identify(\"perameles\") |>   select(basisOfRecord, group = \"basic\") |>   collect() }"},{"path":"/reference/swe.html","id":null,"dir":"Reference","previous_headings":"","what":"Basic Sweden polygons for visualization — swe","title":"Basic Sweden polygons for visualization — swe","text":"basic polygon data set Simple Feature Collection (package sf) representing Sweden. basic polygon data set Simple Feature Collection (package sf) representing Sweden.","code":""},{"path":"/reference/swe.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Basic Sweden polygons for visualization — swe","text":"","code":"data(swe)  data(swe_wgs84)"},{"path":"/reference/swe.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Basic Sweden polygons for visualization — swe","text":"list Simple Feature Collection (package sf) CRS: EPSG:3006","code":""},{"path":"/reference/swe.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Basic Sweden polygons for visualization — swe","text":"Statistikmyndigheten SCB https://www.scb.se/hitta-statistik/regional-statistik-och-kartor/regionala-indelningar/digitala-granser","code":""},{"path":"/reference/Sweden_Grid.html","id":null,"dir":"Reference","previous_headings":"","what":"The standard Swedish squared grid — Sweden_Grid","title":"The standard Swedish squared grid — Sweden_Grid","text":"5, 10, 25 50 km wide grid data set Simple Feature Collection (package sf) Sweden.","code":""},{"path":"/reference/Sweden_Grid.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"The standard Swedish squared grid — Sweden_Grid","text":"","code":"data(Sweden_Grid_5km_Wgs84)  data(Sweden_Grid_10km_Wgs84)  data(Sweden_Grid_25km_Wgs84)  data(Sweden_Grid_50km_Wgs84)"},{"path":"/reference/Sweden_Grid.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"The standard Swedish squared grid — Sweden_Grid","text":"Simple Feature Collection (package sf) CRS: EPSG:4326","code":""},{"path":"/reference/Sweden_Grid.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"The standard Swedish squared grid — Sweden_Grid","text":"https://github.com/biodiversitydata-se/Sweden_Grids","code":""}]
